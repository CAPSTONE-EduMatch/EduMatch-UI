#!/usr/bin/env sh
set -e

echo "ğŸ™ Performing commit message checks..."

# Remove these 2 lines when you upgrade to Husky v10
# . "$(dirname "$0")/_/husky.sh"

PNPM="$HOME/.local/share/pnpm/pnpm"

# Ensure Node is reachable (add your Node bin if needed)
if ! command -v node >/dev/null 2>&1; then
  # nvm default (adjust if you use volta/asdf)
  if [ -s "$HOME/.nvm/nvm.sh" ]; then
    . "$HOME/.nvm/nvm.sh" >/dev/null 2>&1 || true
    nvm use default >/dev/null 2>&1 || true
  fi
fi

run_pm() {
  if [ -x "$PNPM" ]; then
    "$PNPM" "$@"
  elif command -v pnpm >/dev/null 2>&1; then
    pnpm "$@"
  else
    # fall back to npx using the local devDependency
    if [ "$1" = "exec" ]; then shift; npx --no-install "$@"
    else echo "pnpm not available for: $*"; exit 127; fi
  fi
}

run_pm exec commitlint --edit "$1"

echo "Your commit message is a work of art. Chef kiss ğŸ§‘â€ğŸ³ğŸ˜™ğŸ¤Œ. Nice job ğŸ‘"
