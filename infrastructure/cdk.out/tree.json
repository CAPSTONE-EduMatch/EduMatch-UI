{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.219.0"},"children":{"EduMatchNotificationStack":{"id":"EduMatchNotificationStack","path":"EduMatchNotificationStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.219.0"},"children":{"NotificationsDLQ":{"id":"NotificationsDLQ","path":"EduMatchNotificationStack/NotificationsDLQ","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/NotificationsDLQ/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"contentBasedDeduplication":true,"fifoQueue":true,"messageRetentionPeriod":1209600,"queueName":"edumatch-notifications-dlq.fifo"}}}}},"NotificationsQueue":{"id":"NotificationsQueue","path":"EduMatchNotificationStack/NotificationsQueue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/NotificationsQueue/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"contentBasedDeduplication":true,"fifoQueue":true,"messageRetentionPeriod":1209600,"queueName":"edumatch-notifications.fifo","redrivePolicy":{"deadLetterTargetArn":{"Fn::GetAtt":["NotificationsDLQ7EE1DB27","Arn"]},"maxReceiveCount":3},"visibilityTimeout":300}}}}},"EmailsDLQ":{"id":"EmailsDLQ","path":"EduMatchNotificationStack/EmailsDLQ","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EmailsDLQ/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"contentBasedDeduplication":true,"fifoQueue":true,"messageRetentionPeriod":1209600,"queueName":"edumatch-emails-dlq.fifo"}}}}},"EmailsQueue":{"id":"EmailsQueue","path":"EduMatchNotificationStack/EmailsQueue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EmailsQueue/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"contentBasedDeduplication":true,"fifoQueue":true,"messageRetentionPeriod":1209600,"queueName":"edumatch-emails.fifo","redrivePolicy":{"deadLetterTargetArn":{"Fn::GetAtt":["EmailsDLQ1B20FAB8","Arn"]},"maxReceiveCount":3},"visibilityTimeout":300}}}}},"NotificationLambdaRole":{"id":"NotificationLambdaRole","path":"EduMatchNotificationStack/NotificationLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportNotificationLambdaRole":{"id":"ImportNotificationLambdaRole","path":"EduMatchNotificationStack/NotificationLambdaRole/ImportNotificationLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/NotificationLambdaRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"policies":[{"policyName":"SQSAndSESPolicy","policyDocument":{"Statement":[{"Action":["sqs:ChangeMessageVisibility","sqs:DeleteMessage","sqs:GetQueueAttributes","sqs:ReceiveMessage"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["EmailsDLQ1B20FAB8","Arn"]},{"Fn::GetAtt":["EmailsQueue3086DFE6","Arn"]},{"Fn::GetAtt":["NotificationsDLQ7EE1DB27","Arn"]},{"Fn::GetAtt":["NotificationsQueue3B766469","Arn"]}]},{"Action":["ses:SendEmail","ses:SendRawEmail"],"Effect":"Allow","Resource":"*"},{"Action":["dynamodb:DeleteItem","dynamodb:GetItem","dynamodb:PutItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem"],"Effect":"Allow","Resource":"arn:aws:dynamodb:*:*:table/edumatch-*"}],"Version":"2012-10-17"}}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"EduMatchNotificationStack/NotificationLambdaRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/NotificationLambdaRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["sqs:ChangeMessageVisibility","sqs:DeleteMessage","sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:ReceiveMessage"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["EmailsQueue3086DFE6","Arn"]},{"Fn::GetAtt":["NotificationsQueue3B766469","Arn"]}]},{"Action":["dynamodb:BatchWriteItem","dynamodb:DeleteItem","dynamodb:DescribeTable","dynamodb:PutItem","dynamodb:UpdateItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["MessageReadsTable793D4BB1","Arn"]},{"Fn::GetAtt":["MessagesTable05B58A27","Arn"]},{"Fn::GetAtt":["ThreadsTable1D5C607C","Arn"]},{"Ref":"AWS::NoValue"}]},{"Action":["dynamodb:BatchGetItem","dynamodb:ConditionCheckItem","dynamodb:DescribeTable","dynamodb:GetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:Scan"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["MessagesTable05B58A27","Arn"]},{"Ref":"AWS::NoValue"}]}],"Version":"2012-10-17"},"policyName":"NotificationLambdaRoleDefaultPolicy07D18877","roles":[{"Ref":"NotificationLambdaRole8517A721"}]}}}}}}},"NotificationProcessorLogGroup":{"id":"NotificationProcessorLogGroup","path":"EduMatchNotificationStack/NotificationProcessorLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/NotificationProcessorLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"retentionInDays":7}}}}},"NotificationProcessor":{"id":"NotificationProcessor","path":"EduMatchNotificationStack/NotificationProcessor","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/NotificationProcessor/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nconst { SQSClient, SendMessageCommand } = require('@aws-sdk/client-sqs');\n\nconst sqsClient = new SQSClient({ region: 'ap-northeast-1' });\n\nexports.handler = async (event) => {\n  for (const record of event.Records) {\n    try {\n      const message = JSON.parse(record.body);\n      \n      // Store notification in database\n      await storeNotificationInDatabase(message);\n      \n      // Forward message to email queue\n      const emailCommand = new SendMessageCommand({\n        QueueUrl: process.env.EMAILS_QUEUE_URL,\n        MessageBody: JSON.stringify(message),\n        MessageAttributes: {\n          Type: {\n            DataType: 'String',\n            StringValue: message.type,\n          },\n          UserEmail: {\n            DataType: 'String',\n            StringValue: message.userEmail,\n          },\n        },\n        MessageGroupId: message.userEmail,\n        MessageDeduplicationId: message.id,\n      });\n      \n      await sqsClient.send(emailCommand);\n      \n    } catch (error) {\n      console.error('Error processing notification:', error);\n      throw error; // This will trigger retry\n    }\n  }\n};\n\nasync function storeNotificationInDatabase(message) {\n  try {\n    // Create notification title and body based on type\n    let title = \"\";\n    let bodyText = \"\";\n    let url = \"/\";\n\n    switch (message.type) {\n      case \"WELCOME\":\n        title = \"Welcome to EduMatch!\";\n        bodyText = `Welcome ${message.metadata?.firstName || \"User\"}! Your account has been created successfully.`;\n        url = \"/profile/create\";\n        break;\n      case \"PROFILE_CREATED\":\n        title = \"Profile Created Successfully!\";\n        bodyText = `Your ${message.metadata?.role || \"profile\"} profile has been created and is now live.`;\n        url = \"/profile/view\";\n        break;\n      case \"PAYMENT_DEADLINE\":\n        title = \"Payment Deadline Reminder\";\n        bodyText = `Your ${message.metadata?.planName || \"subscription\"} payment is due on ${message.metadata?.deadlineDate || \"soon\"}.`;\n        url = \"/pricing\";\n        break;\n      default:\n        title = \"New Notification\";\n        bodyText = \"You have a new notification from EduMatch.\";\n        break;\n    }\n\n    // Call your API to store notification\n    const response = await fetch(`${process.env.API_BASE_URL || 'https://your-app-url.com'}/api/notifications/store`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        id: message.id,\n        userId: message.userId,\n        type: message.type,\n        title,\n        bodyText,\n        url,\n        createAt: message.createAt || new Date().toISOString(),\n        queuedAt: message.queuedAt || new Date().toISOString(),\n        payload: message.metadata || {},\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to store notification: ${response.status}`);\n    }\n  } catch (error) {\n    console.error('âŒ Error storing notification in database:', error);\n    throw error;\n  }\n}\n      "},"environment":{"variables":{"NOTIFICATIONS_QUEUE_URL":{"Ref":"NotificationsQueue3B766469"},"EMAILS_QUEUE_URL":{"Ref":"EmailsQueue3086DFE6"}}},"handler":"index.handler","loggingConfig":{"logGroup":{"Ref":"NotificationProcessorLogGroup84C9CB83"}},"memorySize":256,"role":{"Fn::GetAtt":["NotificationLambdaRole8517A721","Arn"]},"runtime":"nodejs18.x","timeout":300}}},"SqsEventSource:EduMatchNotificationStackNotificationsQueueD5B21BB6":{"id":"SqsEventSource:EduMatchNotificationStackNotificationsQueueD5B21BB6","path":"EduMatchNotificationStack/NotificationProcessor/SqsEventSource:EduMatchNotificationStackNotificationsQueueD5B21BB6","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.EventSourceMapping","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/NotificationProcessor/SqsEventSource:EduMatchNotificationStackNotificationsQueueD5B21BB6/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnEventSourceMapping","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::EventSourceMapping","aws:cdk:cloudformation:props":{"batchSize":10,"eventSourceArn":{"Fn::GetAtt":["NotificationsQueue3B766469","Arn"]},"functionName":{"Ref":"NotificationProcessorE91924AA"}}}}}}}},"EmailProcessorLogGroup":{"id":"EmailProcessorLogGroup","path":"EduMatchNotificationStack/EmailProcessorLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EmailProcessorLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"retentionInDays":7}}}}},"EmailProcessor":{"id":"EmailProcessor","path":"EduMatchNotificationStack/EmailProcessor","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EmailProcessor/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nconst { SQSClient, ReceiveMessageCommand, DeleteMessageCommand } = require('@aws-sdk/client-sqs');\nconst https = require('https');\n\nconst sqsClient = new SQSClient({ region: 'ap-northeast-1' });\n\n// Email templates (simplified versions)\nconst emailTemplates = {\n  WELCOME: (metadata) => ({\n    subject: `Welcome to EduMatch, ${metadata.firstName}!`,\n    html: `\n      <h1>Welcome to EduMatch!</h1>\n      <p>Hello ${metadata.firstName} ${metadata.lastName},</p>\n      <p>Welcome to EduMatch! We're thrilled to have you join our community.</p>\n      <p>Best regards,<br>The EduMatch Team</p>\n    `\n  }),\n  PROFILE_CREATED: (metadata) => ({\n    subject: 'Profile Created Successfully - Welcome to EduMatch!',\n    html: `\n      <h1>Profile Created Successfully!</h1>\n      <p>Congratulations, ${metadata.firstName}!</p>\n      <p>Your ${metadata.role} profile has been successfully created.</p>\n      <p>Best regards,<br>The EduMatch Team</p>\n    `\n  }),\n  PAYMENT_DEADLINE: (metadata) => ({\n    subject: `Payment Deadline Reminder - ${metadata.planName} Subscription`,\n    html: `\n      <h1>Payment Deadline Reminder</h1>\n      <p>Your ${metadata.planName} subscription payment is due soon.</p>\n      <p>Amount: ${metadata.currency} ${metadata.amount}</p>\n      <p>Deadline: ${new Date(metadata.deadlineDate).toLocaleDateString()}</p>\n      <p>Best regards,<br>The EduMatch Team</p>\n    `\n  }),\n  APPLICATION_STATUS_UPDATE: (metadata) => ({\n    subject: `Application Status Update - ${metadata.programName}`,\n    html: `\n      <h1>Application Status Update</h1>\n      <p>Your application to ${metadata.programName} at ${metadata.institutionName} has been updated.</p>\n      <p>New Status: ${metadata.newStatus}</p>\n      <p>Best regards,<br>The EduMatch Team</p>\n    `\n  }),\n  PAYMENT_SUCCESS: (metadata) => ({\n    subject: `Payment Successful - ${metadata.planName} Subscription`,\n    html: `\n      <h1>Payment Successful!</h1>\n      <p>Thank you for your payment.</p>\n      <p>Plan: ${metadata.planName}</p>\n      <p>Amount: ${metadata.currency} ${metadata.amount}</p>\n      <p>Best regards,<br>The EduMatch Team</p>\n    `\n  }),\n  PAYMENT_FAILED: (metadata) => ({\n    subject: `Payment Failed - ${metadata.planName} Subscription`,\n    html: `\n      <h1>Payment Failed</h1>\n      <p>We were unable to process your payment for ${metadata.planName}.</p>\n      <p>Reason: ${metadata.failureReason}</p>\n      <p>Best regards,<br>The EduMatch Team</p>\n    `\n  }),\n  SUBSCRIPTION_EXPIRING: (metadata) => ({\n    subject: `Subscription Expiring Soon - ${metadata.planName}`,\n    html: `\n      <h1>Subscription Expiring Soon</h1>\n      <p>Your ${metadata.planName} subscription will expire in ${metadata.daysRemaining} days.</p>\n      <p>Expiry Date: ${new Date(metadata.expiryDate).toLocaleDateString()}</p>\n      <p>Best regards,<br>The EduMatch Team</p>\n    `\n  })\n};\n\nexports.handler = async (event) => {\n  for (const record of event.Records) {\n    try {\n      const message = JSON.parse(record.body);\n      \n      // Get email template\n      const template = emailTemplates[message.type];\n      if (!template) {\n        console.error('Unknown email type:', message.type);\n        continue;\n      }\n      \n      const emailContent = template(message.metadata);\n      \n      // Send email by calling your Next.js app's email API\n      const emailPayload = {\n        to: message.userEmail,\n        subject: emailContent.subject,\n        html: emailContent.html,\n        from: 'edumatch.noreply@gmail.com'\n      };\n      \n      // Call your Next.js app's email API endpoint\n      // Try localhost first (for development), then fallback to deployed URL\n      let baseUrl = 'http://localhost:3000';\n      try {\n        // Try localhost first\n        const localhostResponse = await fetch('http://localhost:3000/api/send-email', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(emailPayload),\n          signal: AbortSignal.timeout(2000) // 2 second timeout\n        });\n        \n        if (localhostResponse.ok) {\n          continue; // Skip to next message\n        }\n      } catch (localhostError) {\n        // Localhost not available, continue to deployed URL\n      }\n      \n      // Fallback to deployed URL\n      baseUrl = 'https://dev.d1jaxpbx3axxsh.amplifyapp.com';\n      const response = await fetch('https://dev.d1jaxpbx3axxsh.amplifyapp.com/api/send-email', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(emailPayload)\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        console.error('Failed to send email via deployed URL:', response.status, errorData);\n        throw new Error(`Email sending failed: ${response.status} - ${errorData.error}`);\n      }\n      \n    } catch (error) {\n      console.error('Error processing email:', error);\n      throw error; // This will trigger retry\n    }\n  }\n};\n      "},"handler":"index.handler","loggingConfig":{"logGroup":{"Ref":"EmailProcessorLogGroup8A79A2C8"}},"memorySize":256,"role":{"Fn::GetAtt":["NotificationLambdaRole8517A721","Arn"]},"runtime":"nodejs18.x","timeout":300}}},"SqsEventSource:EduMatchNotificationStackEmailsQueueA17FD60A":{"id":"SqsEventSource:EduMatchNotificationStackEmailsQueueA17FD60A","path":"EduMatchNotificationStack/EmailProcessor/SqsEventSource:EduMatchNotificationStackEmailsQueueA17FD60A","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.EventSourceMapping","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EmailProcessor/SqsEventSource:EduMatchNotificationStackEmailsQueueA17FD60A/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnEventSourceMapping","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::EventSourceMapping","aws:cdk:cloudformation:props":{"batchSize":10,"eventSourceArn":{"Fn::GetAtt":["EmailsQueue3086DFE6","Arn"]},"functionName":{"Ref":"EmailProcessor218EC076"}}}}}}}},"MessagesTable":{"id":"MessagesTable","path":"EduMatchNotificationStack/MessagesTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/MessagesTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"threadId","attributeType":"S"},{"attributeName":"createdAt","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"threadId","keyType":"HASH"},{"attributeName":"createdAt","keyType":"RANGE"}],"tableName":"edumatch-messages-v2"}}},"ScalingRole":{"id":"ScalingRole","path":"EduMatchNotificationStack/MessagesTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}}}},"ThreadsTable":{"id":"ThreadsTable","path":"EduMatchNotificationStack/ThreadsTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/ThreadsTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"userId","attributeType":"S"},{"attributeName":"threadId","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"userId","keyType":"HASH"},{"attributeName":"threadId","keyType":"RANGE"}],"tableName":"edumatch-threads-v2"}}},"ScalingRole":{"id":"ScalingRole","path":"EduMatchNotificationStack/ThreadsTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}}}},"MessageReadsTable":{"id":"MessageReadsTable","path":"EduMatchNotificationStack/MessageReadsTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/MessageReadsTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"messageId","attributeType":"S"},{"attributeName":"userId","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"messageId","keyType":"HASH"},{"attributeName":"userId","keyType":"RANGE"}],"tableName":"edumatch-message-reads-v2"}}},"ScalingRole":{"id":"ScalingRole","path":"EduMatchNotificationStack/MessageReadsTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}}}},"ThreadManagerLogGroup":{"id":"ThreadManagerLogGroup","path":"EduMatchNotificationStack/ThreadManagerLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/ThreadManagerLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"retentionInDays":7}}}}},"ThreadManager":{"id":"ThreadManager","path":"EduMatchNotificationStack/ThreadManager","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/ThreadManager/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nconst { DynamoDBClient, PutItemCommand } = require('@aws-sdk/client-dynamodb');\nconst { marshall } = require('@aws-sdk/util-dynamodb');\n\nconst dynamoClient = new DynamoDBClient({ region: 'ap-northeast-1' });\n\nexports.handler = async (event) => {\n  try {\n    const { currentUserId, participantId, threadId, createdAt, userName, userEmail, userImage } = event.arguments.input;\n    \n    if (!currentUserId || !participantId || !threadId) {\n      throw new Error('Missing required parameters: currentUserId, participantId, or threadId');\n    }\n    \n    // Create thread entry for current user\n    const currentUserThread = {\n      userId: currentUserId,\n      threadId: threadId,\n      id: threadId,\n      user1Id: currentUserId,\n      user2Id: participantId,\n      lastMessage: \"\",\n      lastMessageAt: createdAt,\n      lastMessageSenderId: null,\n      lastMessageSenderName: null,\n      lastMessageSenderImage: null,\n      lastMessageFileUrl: null,\n      lastMessageFileName: null,\n      lastMessageMimeType: null,\n      createdAt: createdAt,\n      updatedAt: createdAt,\n      unreadCount: 0\n    };\n    \n    // Create thread entry for participant\n    const participantThread = {\n      userId: participantId,\n      threadId: threadId,\n      id: threadId,\n      user1Id: participantId,\n      user2Id: currentUserId,\n      lastMessage: \"\",\n      lastMessageAt: createdAt,\n      lastMessageSenderId: null,\n      lastMessageSenderName: null,\n      lastMessageSenderImage: null,\n      lastMessageFileUrl: null,\n      lastMessageFileName: null,\n      lastMessageMimeType: null,\n      createdAt: createdAt,\n      updatedAt: createdAt,\n      unreadCount: 0\n    };\n    \n    // Put both thread entries\n    const currentUserCommand = new PutItemCommand({\n      TableName: process.env.THREADS_TABLE_NAME,\n      Item: marshall(currentUserThread)\n    });\n    \n    const participantCommand = new PutItemCommand({\n      TableName: process.env.THREADS_TABLE_NAME,\n      Item: marshall(participantThread)\n    });\n    \n    await Promise.all([\n      dynamoClient.send(currentUserCommand),\n      dynamoClient.send(participantCommand)\n    ]);\n    \n    // Return the current user's thread entry\n    return currentUserThread;\n    \n  } catch (error) {\n    console.error('Error in thread manager:', error);\n    throw error;\n  }\n};\n      "},"environment":{"variables":{"THREADS_TABLE_NAME":{"Ref":"ThreadsTable1D5C607C"}}},"handler":"index.handler","loggingConfig":{"logGroup":{"Ref":"ThreadManagerLogGroupB3777F31"}},"memorySize":256,"role":{"Fn::GetAtt":["NotificationLambdaRole8517A721","Arn"]},"runtime":"nodejs18.x","timeout":30}}}}},"MessageManagerLogGroup":{"id":"MessageManagerLogGroup","path":"EduMatchNotificationStack/MessageManagerLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/MessageManagerLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"retentionInDays":7}}}}},"MessageManager":{"id":"MessageManager","path":"EduMatchNotificationStack/MessageManager","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/MessageManager/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nconst { DynamoDBClient, PutItemCommand, UpdateItemCommand } = require('@aws-sdk/client-dynamodb');\nconst { marshall, unmarshall } = require('@aws-sdk/util-dynamodb');\n\nconst dynamoClient = new DynamoDBClient({ region: 'ap-northeast-1' });\n\nexports.handler = async (event) => {\n  try {\n    const { threadId, content, senderId, senderName, senderImage, fileUrl, fileName, mimeType } = event.arguments.input;\n    \n    if (!threadId || !content || !senderId) {\n      throw new Error('Missing required parameters: threadId, content, or senderId');\n    }\n    \n    const messageId = event.arguments.input.messageId || require('crypto').randomUUID();\n    const createdAt = event.arguments.input.createdAt || new Date().toISOString();\n    \n    // Create the message\n    const message = {\n      threadId: threadId,\n      createdAt: createdAt,\n      id: messageId,\n      content: content,\n      senderId: senderId,\n      senderName: senderName,\n      senderImage: senderImage,\n      fileUrl: fileUrl || null,\n      fileName: fileName || null,\n      mimeType: mimeType || null,\n      isRead: false,\n      readAt: null\n    };\n    \n    // Put the message\n    const messageCommand = new PutItemCommand({\n      TableName: process.env.MESSAGES_TABLE_NAME,\n      Item: marshall(message)\n    });\n    \n    await dynamoClient.send(messageCommand);\n    \n    // Update thread information for both users\n    // First, get the thread to find both users\n    const threadQuery = {\n      TableName: process.env.THREADS_TABLE_NAME,\n      FilterExpression: 'threadId = :threadId',\n      ExpressionAttributeValues: {\n        ':threadId': { S: threadId }\n      }\n    };\n    \n    const { ScanCommand } = require('@aws-sdk/client-dynamodb');\n    const scanCommand = new ScanCommand(threadQuery);\n    const threadResult = await dynamoClient.send(scanCommand);\n    \n    if (threadResult.Items && threadResult.Items.length > 0) {\n      // Update each thread entry\n      for (const threadItem of threadResult.Items) {\n        const thread = unmarshall(threadItem);\n        \n        // Determine if this thread entry is for the sender or recipient\n        const isSender = thread.userId === senderId;\n        \n        let updateCommand;\n        if (isSender) {\n          // For sender: set unreadCount to 0\n          updateCommand = new UpdateItemCommand({\n            TableName: process.env.THREADS_TABLE_NAME,\n            Key: {\n              userId: { S: thread.userId },\n              threadId: { S: thread.threadId }\n            },\n            UpdateExpression: 'SET lastMessage = :lastMessage, lastMessageAt = :lastMessageAt, lastMessageSenderId = :lastMessageSenderId, lastMessageSenderName = :lastMessageSenderName, lastMessageSenderImage = :lastMessageSenderImage, lastMessageFileUrl = :lastMessageFileUrl, lastMessageFileName = :lastMessageFileName, lastMessageMimeType = :lastMessageMimeType, updatedAt = :updatedAt, unreadCount = :zero',\n            ExpressionAttributeValues: {\n              ':lastMessage': { S: content },\n              ':lastMessageAt': { S: createdAt },\n              ':lastMessageSenderId': { S: senderId },\n              ':lastMessageSenderName': { S: senderName || '' },\n              ':lastMessageSenderImage': { S: senderImage || '' },\n              ':lastMessageFileUrl': { S: fileUrl || '' },\n              ':lastMessageFileName': { S: fileName || '' },\n              ':lastMessageMimeType': { S: mimeType || '' },\n              ':updatedAt': { S: createdAt },\n              ':zero': { N: '0' }\n            }\n          });\n        } else {\n          // For recipient: increment unreadCount\n          updateCommand = new UpdateItemCommand({\n            TableName: process.env.THREADS_TABLE_NAME,\n            Key: {\n              userId: { S: thread.userId },\n              threadId: { S: thread.threadId }\n            },\n            UpdateExpression: 'SET lastMessage = :lastMessage, lastMessageAt = :lastMessageAt, lastMessageSenderId = :lastMessageSenderId, lastMessageSenderName = :lastMessageSenderName, lastMessageSenderImage = :lastMessageSenderImage, lastMessageFileUrl = :lastMessageFileUrl, lastMessageFileName = :lastMessageFileName, lastMessageMimeType = :lastMessageMimeType, updatedAt = :updatedAt, unreadCount = unreadCount + :one',\n            ExpressionAttributeValues: {\n              ':lastMessage': { S: content },\n              ':lastMessageAt': { S: createdAt },\n              ':lastMessageSenderId': { S: senderId },\n              ':lastMessageSenderName': { S: senderName || '' },\n              ':lastMessageSenderImage': { S: senderImage || '' },\n              ':lastMessageFileUrl': { S: fileUrl || '' },\n              ':lastMessageFileName': { S: fileName || '' },\n              ':lastMessageMimeType': { S: mimeType || '' },\n              ':updatedAt': { S: createdAt },\n              ':one': { N: '1' }\n            }\n          });\n        }\n        \n        await dynamoClient.send(updateCommand);\n      }\n    }\n    \n    return message;\n    \n  } catch (error) {\n    console.error('Error in message manager:', error);\n    throw error;\n  }\n};\n      "},"environment":{"variables":{"MESSAGES_TABLE_NAME":{"Ref":"MessagesTable05B58A27"},"THREADS_TABLE_NAME":{"Ref":"ThreadsTable1D5C607C"}}},"handler":"index.handler","loggingConfig":{"logGroup":{"Ref":"MessageManagerLogGroup706CEE6F"}},"memorySize":256,"role":{"Fn::GetAtt":["NotificationLambdaRole8517A721","Arn"]},"runtime":"nodejs18.x","timeout":30}}}}},"MarkReadManagerLogGroup":{"id":"MarkReadManagerLogGroup","path":"EduMatchNotificationStack/MarkReadManagerLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/MarkReadManagerLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"retentionInDays":7}}}}},"MarkReadManager":{"id":"MarkReadManager","path":"EduMatchNotificationStack/MarkReadManager","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/MarkReadManager/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nconst { DynamoDBClient, PutItemCommand, UpdateItemCommand, GetItemCommand } = require('@aws-sdk/client-dynamodb');\nconst { marshall, unmarshall } = require('@aws-sdk/util-dynamodb');\n\nconst dynamoClient = new DynamoDBClient({ region: 'ap-northeast-1' });\n\nexports.handler = async (event) => {\n  try {\n    const { messageId, userId } = event.arguments.input;\n    \n    if (!messageId || !userId) {\n      throw new Error('Missing required parameters: messageId or userId');\n    }\n    \n    const readId = event.arguments.input.readId || require('crypto').randomUUID();\n    const readAt = event.arguments.input.readAt || new Date().toISOString();\n    \n    // First, get the message to find the threadId\n    const messageCommand = new GetItemCommand({\n      TableName: process.env.MESSAGES_TABLE_NAME,\n      Key: {\n        threadId: { S: 'temp' }, // We need to scan to find the message\n        createdAt: { S: 'temp' }\n      }\n    });\n    \n    // Since we don't have threadId, we need to scan for the message\n    const { ScanCommand } = require('@aws-sdk/client-dynamodb');\n    const scanCommand = new ScanCommand({\n      TableName: process.env.MESSAGES_TABLE_NAME,\n      FilterExpression: 'id = :messageId',\n      ExpressionAttributeValues: {\n        ':messageId': { S: messageId }\n      }\n    });\n    \n    const messageResult = await dynamoClient.send(scanCommand);\n    \n    if (!messageResult.Items || messageResult.Items.length === 0) {\n      throw new Error('Message not found');\n    }\n    \n    const message = unmarshall(messageResult.Items[0]);\n    const threadId = message.threadId;\n    \n    // Create the read record\n    const readRecord = {\n      messageId: messageId,\n      userId: userId,\n      id: readId,\n      readAt: readAt\n    };\n    \n    const readCommand = new PutItemCommand({\n      TableName: process.env.MESSAGE_READS_TABLE_NAME,\n      Item: marshall(readRecord)\n    });\n    \n    await dynamoClient.send(readCommand);\n    \n    // Update the thread's unread count for this user\n    const threadQuery = {\n      TableName: process.env.THREADS_TABLE_NAME,\n      FilterExpression: 'threadId = :threadId AND userId = :userId',\n      ExpressionAttributeValues: {\n        ':threadId': { S: threadId },\n        ':userId': { S: userId }\n      }\n    };\n    \n    const threadScanCommand = new ScanCommand(threadQuery);\n    const threadResult = await dynamoClient.send(threadScanCommand);\n    \n    if (threadResult.Items && threadResult.Items.length > 0) {\n      const thread = unmarshall(threadResult.Items[0]);\n      \n      const updateCommand = new UpdateItemCommand({\n        TableName: process.env.THREADS_TABLE_NAME,\n        Key: {\n          userId: { S: thread.userId },\n          threadId: { S: thread.threadId }\n        },\n        UpdateExpression: 'SET unreadCount = unreadCount - :one',\n        ConditionExpression: 'unreadCount > :zero',\n        ExpressionAttributeValues: {\n          ':one': { N: '1' },\n          ':zero': { N: '0' }\n        }\n      });\n      \n      try {\n        await dynamoClient.send(updateCommand);\n      } catch (error) {\n        // If unreadCount is already 0, that's fine\n      }\n    }\n    \n    return readRecord;\n    \n  } catch (error) {\n    console.error('Error in mark read manager:', error);\n    throw error;\n  }\n};\n      "},"environment":{"variables":{"MESSAGES_TABLE_NAME":{"Ref":"MessagesTable05B58A27"},"THREADS_TABLE_NAME":{"Ref":"ThreadsTable1D5C607C"},"MESSAGE_READS_TABLE_NAME":{"Ref":"MessageReadsTable793D4BB1"}}},"handler":"index.handler","loggingConfig":{"logGroup":{"Ref":"MarkReadManagerLogGroup81DB0517"}},"memorySize":256,"role":{"Fn::GetAtt":["NotificationLambdaRole8517A721","Arn"]},"runtime":"nodejs18.x","timeout":30}}}}},"ClearUnreadManagerLogGroup":{"id":"ClearUnreadManagerLogGroup","path":"EduMatchNotificationStack/ClearUnreadManagerLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/ClearUnreadManagerLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"retentionInDays":7}}}}},"ClearUnreadManager":{"id":"ClearUnreadManager","path":"EduMatchNotificationStack/ClearUnreadManager","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/ClearUnreadManager/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nconst { DynamoDBClient, UpdateItemCommand } = require('@aws-sdk/client-dynamodb');\n\nconst dynamoClient = new DynamoDBClient({ region: 'ap-northeast-1' });\n\nexports.handler = async (event) => {\n  try {\n    const { threadId, userId } = event.arguments.input;\n    \n    if (!threadId || !userId) {\n      throw new Error('Missing required parameters: threadId or userId');\n    }\n    \n    // Update the thread's unread count to 0 for this user\n    const updateCommand = new UpdateItemCommand({\n      TableName: process.env.THREADS_TABLE_NAME,\n      Key: {\n        userId: { S: userId },\n        threadId: { S: threadId }\n      },\n      UpdateExpression: 'SET unreadCount = :zero',\n      ExpressionAttributeValues: {\n        ':zero': { N: '0' }\n      },\n      ReturnValues: 'ALL_NEW'\n    });\n    \n    const result = await dynamoClient.send(updateCommand);\n    \n    return {\n      id: threadId,\n      unreadCount: 0\n    };\n    \n  } catch (error) {\n    console.error('Error in clear unread manager:', error);\n    throw error;\n  }\n};\n      "},"environment":{"variables":{"THREADS_TABLE_NAME":{"Ref":"ThreadsTable1D5C607C"}}},"handler":"index.handler","loggingConfig":{"logGroup":{"Ref":"ClearUnreadManagerLogGroupA2D34E3A"}},"memorySize":256,"role":{"Fn::GetAtt":["NotificationLambdaRole8517A721","Arn"]},"runtime":"nodejs18.x","timeout":30}}}}},"UserPool":{"id":"UserPool","path":"EduMatchNotificationStack/UserPool","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"EduMatchMessagingApi":{"id":"EduMatchMessagingApi","path":"EduMatchNotificationStack/EduMatchMessagingApi","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.GraphqlApi","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnGraphQLApi","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::GraphQLApi","aws:cdk:cloudformation:props":{"additionalAuthenticationProviders":[{"authenticationType":"AMAZON_COGNITO_USER_POOLS","userPoolConfig":{"userPoolId":"us-east-1_XXXXXXXXX","awsRegion":"ap-northeast-1","defaultAction":"ALLOW"}}],"authenticationType":"API_KEY","name":"EduMatchMessagingApi","xrayEnabled":true}}},"Schema":{"id":"Schema","path":"EduMatchNotificationStack/EduMatchMessagingApi/Schema","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnGraphQLSchema","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::GraphQLSchema","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"definition":"type User {\n\tid: ID!\n\tname: String!\n\temail: String!\n\timage: String\n}\n\ntype Message {\n\tid: ID!\n\tthreadId: ID!\n\tcontent: String!\n\tsenderId: ID!\n\tsenderName: String!\n\tsenderImage: String\n\tcreatedAt: String!\n\tfileUrl: String\n\tfileName: String\n\tmimeType: String\n\tisRead: Boolean!\n\treadAt: String\n}\n\ntype Thread {\n\tid: ID!\n\tuser1Id: ID!\n\tuser2Id: ID!\n\tlastMessage: String\n\tlastMessageAt: String\n\tlastMessageSenderId: ID\n\tlastMessageSenderName: String\n\tlastMessageSenderImage: String\n\tlastMessageFileUrl: String\n\tlastMessageFileName: String\n\tlastMessageMimeType: String\n\tcreatedAt: String!\n\tupdatedAt: String!\n\tunreadCount: Int!\n}\n\ntype MessageRead {\n\tid: ID!\n\tmessageId: ID!\n\tuserId: ID!\n\treadAt: String!\n}\n\ninput CreateMessageInput {\n\tthreadId: ID!\n\tcontent: String!\n\tfileUrl: String\n\tfileName: String\n\tmimeType: String\n\tsenderId: ID\n\tsenderName: String\n\tsenderImage: String\n}\n\ninput CreateThreadInput {\n\tparticipantId: ID!\n\tuserId: ID\n\tuserName: String\n\tuserEmail: String\n\tuserImage: String\n}\n\ninput MarkMessageReadInput {\n\tmessageId: ID!\n\tuserId: ID\n}\n\ninput ClearThreadUnreadCountInput {\n\tthreadId: ID!\n\tuserId: ID\n}\n\ntype Query {\n\tgetThreads(userId: ID): [Thread!]!\n\tgetMessages(threadId: ID!): [Message!]!\n\tgetUnreadCount(userId: ID): Int!\n}\n\ntype Mutation {\n\tcreateMessage(input: CreateMessageInput!): Message!\n\tcreateThread(input: CreateThreadInput!): Thread!\n\tmarkMessageRead(input: MarkMessageReadInput!): MessageRead!\n\tclearThreadUnreadCount(input: ClearThreadUnreadCountInput!): Thread!\n}\n\ntype Subscription {\n\tonMessageAdded(threadId: ID!): Message\n\t\t@aws_subscribe(mutations: [\"createMessage\"])\n\tonThreadCreated: Thread @aws_subscribe(mutations: [\"createThread\"])\n}\n"}}},"DefaultApiKey":{"id":"DefaultApiKey","path":"EduMatchNotificationStack/EduMatchMessagingApi/DefaultApiKey","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnApiKey","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::ApiKey","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"expires":1793966571}}},"LogGroup":{"id":"LogGroup","path":"EduMatchNotificationStack/EduMatchMessagingApi/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"MessagesDataSource":{"id":"MessagesDataSource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessagesDataSource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.DynamoDbDataSource","version":"2.219.0"},"children":{"ServiceRole":{"id":"ServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessagesDataSource/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessagesDataSource/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessagesDataSource/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"appsync.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessagesDataSource/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessagesDataSource/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchGetItem","dynamodb:BatchWriteItem","dynamodb:ConditionCheckItem","dynamodb:DeleteItem","dynamodb:DescribeTable","dynamodb:GetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:PutItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["MessagesTable05B58A27","Arn"]},{"Ref":"AWS::NoValue"}]}],"Version":"2012-10-17"},"policyName":"EduMatchMessagingApiMessagesDataSourceServiceRoleDefaultPolicy0E47B253","roles":[{"Ref":"EduMatchMessagingApiMessagesDataSourceServiceRole6F6DD6BC"}]}}}}}}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessagesDataSource/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnDataSource","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::DataSource","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"dynamoDbConfig":{"tableName":{"Ref":"MessagesTable05B58A27"},"awsRegion":"ap-northeast-1"},"name":"MessagesDataSource","serviceRoleArn":{"Fn::GetAtt":["EduMatchMessagingApiMessagesDataSourceServiceRole6F6DD6BC","Arn"]},"type":"AMAZON_DYNAMODB"}}}}},"ThreadsDataSource":{"id":"ThreadsDataSource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadsDataSource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.DynamoDbDataSource","version":"2.219.0"},"children":{"ServiceRole":{"id":"ServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadsDataSource/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadsDataSource/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadsDataSource/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"appsync.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadsDataSource/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadsDataSource/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchGetItem","dynamodb:BatchWriteItem","dynamodb:ConditionCheckItem","dynamodb:DeleteItem","dynamodb:DescribeTable","dynamodb:GetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:PutItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ThreadsTable1D5C607C","Arn"]},{"Ref":"AWS::NoValue"}]}],"Version":"2012-10-17"},"policyName":"EduMatchMessagingApiThreadsDataSourceServiceRoleDefaultPolicyA5DB5C43","roles":[{"Ref":"EduMatchMessagingApiThreadsDataSourceServiceRole5CD739A8"}]}}}}}}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadsDataSource/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnDataSource","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::DataSource","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"dynamoDbConfig":{"tableName":{"Ref":"ThreadsTable1D5C607C"},"awsRegion":"ap-northeast-1"},"name":"ThreadsDataSource","serviceRoleArn":{"Fn::GetAtt":["EduMatchMessagingApiThreadsDataSourceServiceRole5CD739A8","Arn"]},"type":"AMAZON_DYNAMODB"}}}}},"ThreadManagerDataSource":{"id":"ThreadManagerDataSource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadManagerDataSource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.LambdaDataSource","version":"2.219.0"},"children":{"ServiceRole":{"id":"ServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadManagerDataSource/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadManagerDataSource/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadManagerDataSource/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"appsync.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadManagerDataSource/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadManagerDataSource/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["ThreadManagerD7162686","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ThreadManagerD7162686","Arn"]},":*"]]}]}],"Version":"2012-10-17"},"policyName":"EduMatchMessagingApiThreadManagerDataSourceServiceRoleDefaultPolicyF4BEDC57","roles":[{"Ref":"EduMatchMessagingApiThreadManagerDataSourceServiceRole68DFB733"}]}}}}}}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ThreadManagerDataSource/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnDataSource","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::DataSource","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"lambdaConfig":{"lambdaFunctionArn":{"Fn::GetAtt":["ThreadManagerD7162686","Arn"]}},"name":"ThreadManagerDataSource","serviceRoleArn":{"Fn::GetAtt":["EduMatchMessagingApiThreadManagerDataSourceServiceRole68DFB733","Arn"]},"type":"AWS_LAMBDA"}}}}},"MessageManagerDataSource":{"id":"MessageManagerDataSource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessageManagerDataSource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.LambdaDataSource","version":"2.219.0"},"children":{"ServiceRole":{"id":"ServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessageManagerDataSource/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessageManagerDataSource/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessageManagerDataSource/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"appsync.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessageManagerDataSource/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessageManagerDataSource/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["MessageManager52B59406","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["MessageManager52B59406","Arn"]},":*"]]}]}],"Version":"2012-10-17"},"policyName":"EduMatchMessagingApiMessageManagerDataSourceServiceRoleDefaultPolicyECC8C916","roles":[{"Ref":"EduMatchMessagingApiMessageManagerDataSourceServiceRole8A7A64A2"}]}}}}}}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MessageManagerDataSource/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnDataSource","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::DataSource","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"lambdaConfig":{"lambdaFunctionArn":{"Fn::GetAtt":["MessageManager52B59406","Arn"]}},"name":"MessageManagerDataSource","serviceRoleArn":{"Fn::GetAtt":["EduMatchMessagingApiMessageManagerDataSourceServiceRole8A7A64A2","Arn"]},"type":"AWS_LAMBDA"}}}}},"MarkReadManagerDataSource":{"id":"MarkReadManagerDataSource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MarkReadManagerDataSource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.LambdaDataSource","version":"2.219.0"},"children":{"ServiceRole":{"id":"ServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/MarkReadManagerDataSource/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/MarkReadManagerDataSource/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MarkReadManagerDataSource/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"appsync.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"EduMatchNotificationStack/EduMatchMessagingApi/MarkReadManagerDataSource/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MarkReadManagerDataSource/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["MarkReadManagerA1C8AB18","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["MarkReadManagerA1C8AB18","Arn"]},":*"]]}]}],"Version":"2012-10-17"},"policyName":"EduMatchMessagingApiMarkReadManagerDataSourceServiceRoleDefaultPolicyC0FB4C57","roles":[{"Ref":"EduMatchMessagingApiMarkReadManagerDataSourceServiceRole8E04741F"}]}}}}}}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MarkReadManagerDataSource/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnDataSource","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::DataSource","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"lambdaConfig":{"lambdaFunctionArn":{"Fn::GetAtt":["MarkReadManagerA1C8AB18","Arn"]}},"name":"MarkReadManagerDataSource","serviceRoleArn":{"Fn::GetAtt":["EduMatchMessagingApiMarkReadManagerDataSourceServiceRole8E04741F","Arn"]},"type":"AWS_LAMBDA"}}}}},"ClearUnreadManagerDataSource":{"id":"ClearUnreadManagerDataSource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ClearUnreadManagerDataSource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.LambdaDataSource","version":"2.219.0"},"children":{"ServiceRole":{"id":"ServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/ClearUnreadManagerDataSource/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"EduMatchNotificationStack/EduMatchMessagingApi/ClearUnreadManagerDataSource/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ClearUnreadManagerDataSource/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"appsync.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"EduMatchNotificationStack/EduMatchMessagingApi/ClearUnreadManagerDataSource/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ClearUnreadManagerDataSource/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["ClearUnreadManagerBDCB9586","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ClearUnreadManagerBDCB9586","Arn"]},":*"]]}]}],"Version":"2012-10-17"},"policyName":"EduMatchMessagingApiClearUnreadManagerDataSourceServiceRoleDefaultPolicy7EE0F163","roles":[{"Ref":"EduMatchMessagingApiClearUnreadManagerDataSourceServiceRoleBB1212BB"}]}}}}}}},"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ClearUnreadManagerDataSource/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnDataSource","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::DataSource","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"lambdaConfig":{"lambdaFunctionArn":{"Fn::GetAtt":["ClearUnreadManagerBDCB9586","Arn"]}},"name":"ClearUnreadManagerDataSource","serviceRoleArn":{"Fn::GetAtt":["EduMatchMessagingApiClearUnreadManagerDataSourceServiceRoleBB1212BB","Arn"]},"type":"AWS_LAMBDA"}}}}},"GetMessagesResolver":{"id":"GetMessagesResolver","path":"EduMatchNotificationStack/EduMatchMessagingApi/GetMessagesResolver","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.Resolver","version":"2.219.0"},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/GetMessagesResolver/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnResolver","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::Resolver","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"dataSourceName":"MessagesDataSource","fieldName":"getMessages","kind":"UNIT","requestMappingTemplate":"\n\t\t\t\t{\n\t\t\t\t\t\"version\": \"2017-02-28\",\n\t\t\t\t\t\"operation\": \"Query\",\n\t\t\t\t\t\"query\": {\n\t\t\t\t\t\t\"expression\": \"threadId = :threadId\",\n\t\t\t\t\t\t\"expressionValues\": {\n\t\t\t\t\t\t\t\":threadId\": $util.dynamodb.toDynamoDBJson($ctx.args.threadId)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t","responseMappingTemplate":"$util.toJson($ctx.result.items)","typeName":"Query"}}}}},"CreateMessageResolver":{"id":"CreateMessageResolver","path":"EduMatchNotificationStack/EduMatchMessagingApi/CreateMessageResolver","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.Resolver","version":"2.219.0"},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/CreateMessageResolver/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnResolver","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::Resolver","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"dataSourceName":"MessageManagerDataSource","fieldName":"createMessage","kind":"UNIT","requestMappingTemplate":"\n\t\t\t\t#set($senderId = $ctx.identity.sub)\n\t\t\t\t#set($senderName = $ctx.identity.claims.name)\n\t\t\t\t#set($senderImage = $ctx.identity.claims.picture)\n\t\t\t\t#if($ctx.args.input.senderId)\n\t\t\t\t\t#set($senderId = $ctx.args.input.senderId)\n\t\t\t\t#end\n\t\t\t\t#if($ctx.args.input.senderName)\n\t\t\t\t\t#set($senderName = $ctx.args.input.senderName)\n\t\t\t\t#end\n\t\t\t\t#if($ctx.args.input.senderImage)\n\t\t\t\t\t#set($senderImage = $ctx.args.input.senderImage)\n\t\t\t\t#end\n\t\t\t\t#set($messageId = $util.autoId())\n\t\t\t\t#set($createdAt = $util.time.nowISO8601())\n\t\t\t\t\n\t\t\t\t{\n\t\t\t\t\t\"version\": \"2017-02-28\",\n\t\t\t\t\t\"operation\": \"Invoke\",\n\t\t\t\t\t\"payload\": {\n\t\t\t\t\t\t\"arguments\": {\n\t\t\t\t\t\t\t\"input\": {\n\t\t\t\t\t\t\t\t\"messageId\": $util.toJson($messageId),\n\t\t\t\t\t\t\t\t\"threadId\": $util.toJson($ctx.args.input.threadId),\n\t\t\t\t\t\t\t\t\"content\": $util.toJson($ctx.args.input.content),\n\t\t\t\t\t\t\t\t\"senderId\": $util.toJson($senderId),\n\t\t\t\t\t\t\t\t\"senderName\": $util.toJson($senderName),\n\t\t\t\t\t\t\t\t\"senderImage\": $util.toJson($senderImage),\n\t\t\t\t\t\t\t\t\"fileUrl\": $util.toJson($ctx.args.input.fileUrl),\n\t\t\t\t\t\t\t\t\"fileName\": $util.toJson($ctx.args.input.fileName),\n\t\t\t\t\t\t\t\t\"mimeType\": $util.toJson($ctx.args.input.mimeType),\n\t\t\t\t\t\t\t\t\"createdAt\": $util.toJson($createdAt)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t","responseMappingTemplate":"$util.toJson($ctx.result)","typeName":"Mutation"}}}}},"GetThreadsResolver":{"id":"GetThreadsResolver","path":"EduMatchNotificationStack/EduMatchMessagingApi/GetThreadsResolver","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.Resolver","version":"2.219.0"},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/GetThreadsResolver/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnResolver","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::Resolver","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"dataSourceName":"ThreadsDataSource","fieldName":"getThreads","kind":"UNIT","requestMappingTemplate":"\n\t\t\t\t#set($userId = $ctx.identity.sub)\n\t\t\t\t#if($ctx.args.userId)\n\t\t\t\t\t#set($userId = $ctx.args.userId)\n\t\t\t\t#end\n\t\t\t\t#if($userId)\n\t\t\t\t{\n\t\t\t\t\t\"version\": \"2017-02-28\",\n\t\t\t\t\t\"operation\": \"Query\",\n\t\t\t\t\t\"query\": {\n\t\t\t\t\t\t\"expression\": \"userId = :userId\",\n\t\t\t\t\t\t\"expressionValues\": {\n\t\t\t\t\t\t\t\":userId\": $util.dynamodb.toDynamoDBJson($userId)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t#else\n\t\t\t\t$util.error(\"User ID is required\", \"BadRequest\")\n\t\t\t\t#end\n\t\t\t","responseMappingTemplate":"\n\t\t\t\t#set($items = [])\n\t\t\t\t#foreach($item in $ctx.result.items)\n\t\t\t\t\t#set($item.unreadCount = $util.defaultIfNull($item.unreadCount, 0))\n\t\t\t\t\t$util.qr($items.add($item))\n\t\t\t\t#end\n\t\t\t\t$util.toJson($items)\n\t\t\t","typeName":"Query"}}}}},"CreateThreadResolver":{"id":"CreateThreadResolver","path":"EduMatchNotificationStack/EduMatchMessagingApi/CreateThreadResolver","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.Resolver","version":"2.219.0"},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/CreateThreadResolver/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnResolver","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::Resolver","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"dataSourceName":"ThreadManagerDataSource","fieldName":"createThread","kind":"UNIT","requestMappingTemplate":"\n\t\t\t\t#set($currentUserId = $ctx.identity.sub)\n\t\t\t\t#if($ctx.args.input.userId)\n\t\t\t\t\t#set($currentUserId = $ctx.args.input.userId)\n\t\t\t\t#end\n\t\t\t\t#set($threadId = $util.autoId())\n\t\t\t\t#set($createdAt = $util.time.nowISO8601())\n\t\t\t\t\n\t\t\t\t{\n\t\t\t\t\t\"version\": \"2017-02-28\",\n\t\t\t\t\t\"operation\": \"Invoke\",\n\t\t\t\t\t\"payload\": {\n\t\t\t\t\t\t\"arguments\": {\n\t\t\t\t\t\t\t\"input\": {\n\t\t\t\t\t\t\t\t\"currentUserId\": $util.toJson($currentUserId),\n\t\t\t\t\t\t\t\t\"participantId\": $util.toJson($ctx.args.input.participantId),\n\t\t\t\t\t\t\t\t\"threadId\": $util.toJson($threadId),\n\t\t\t\t\t\t\t\t\"createdAt\": $util.toJson($createdAt),\n\t\t\t\t\t\t\t\t\"userName\": $util.toJson($ctx.args.input.userName),\n\t\t\t\t\t\t\t\t\"userEmail\": $util.toJson($ctx.args.input.userEmail),\n\t\t\t\t\t\t\t\t\"userImage\": $util.toJson($ctx.args.input.userImage)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t","responseMappingTemplate":"$util.toJson($ctx.result)","typeName":"Mutation"}}}}},"MarkMessageReadResolver":{"id":"MarkMessageReadResolver","path":"EduMatchNotificationStack/EduMatchMessagingApi/MarkMessageReadResolver","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.Resolver","version":"2.219.0"},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/MarkMessageReadResolver/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnResolver","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::Resolver","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"dataSourceName":"MarkReadManagerDataSource","fieldName":"markMessageRead","kind":"UNIT","requestMappingTemplate":"\n\t\t\t\t#set($userId = $ctx.identity.sub)\n\t\t\t\t#if($ctx.args.input.userId)\n\t\t\t\t\t#set($userId = $ctx.args.input.userId)\n\t\t\t\t#end\n\t\t\t\t#set($readId = $util.autoId())\n\t\t\t\t#set($readAt = $util.time.nowISO8601())\n\t\t\t\t\n\t\t\t\t{\n\t\t\t\t\t\"version\": \"2017-02-28\",\n\t\t\t\t\t\"operation\": \"Invoke\",\n\t\t\t\t\t\"payload\": {\n\t\t\t\t\t\t\"arguments\": {\n\t\t\t\t\t\t\t\"input\": {\n\t\t\t\t\t\t\t\t\"messageId\": $util.toJson($ctx.args.input.messageId),\n\t\t\t\t\t\t\t\t\"userId\": $util.toJson($userId),\n\t\t\t\t\t\t\t\t\"readId\": $util.toJson($readId),\n\t\t\t\t\t\t\t\t\"readAt\": $util.toJson($readAt)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t","responseMappingTemplate":"$util.toJson($ctx.result)","typeName":"Mutation"}}}}},"ClearThreadUnreadCountResolver":{"id":"ClearThreadUnreadCountResolver","path":"EduMatchNotificationStack/EduMatchMessagingApi/ClearThreadUnreadCountResolver","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.Resolver","version":"2.219.0"},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/ClearThreadUnreadCountResolver/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnResolver","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::Resolver","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"dataSourceName":"ClearUnreadManagerDataSource","fieldName":"clearThreadUnreadCount","kind":"UNIT","requestMappingTemplate":"\n\t\t\t\t#set($userId = $ctx.identity.sub)\n\t\t\t\t#if($ctx.args.input.userId)\n\t\t\t\t\t#set($userId = $ctx.args.input.userId)\n\t\t\t\t#end\n\t\t\t\t\n\t\t\t\t{\n\t\t\t\t\t\"version\": \"2017-02-28\",\n\t\t\t\t\t\"operation\": \"Invoke\",\n\t\t\t\t\t\"payload\": {\n\t\t\t\t\t\t\"arguments\": {\n\t\t\t\t\t\t\t\"input\": {\n\t\t\t\t\t\t\t\t\"threadId\": $util.toJson($ctx.args.input.threadId),\n\t\t\t\t\t\t\t\t\"userId\": $util.toJson($userId)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t","responseMappingTemplate":"$util.toJson($ctx.result)","typeName":"Mutation"}}}}},"GetUnreadCountResolver":{"id":"GetUnreadCountResolver","path":"EduMatchNotificationStack/EduMatchMessagingApi/GetUnreadCountResolver","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.Resolver","version":"2.219.0"},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/EduMatchMessagingApi/GetUnreadCountResolver/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_appsync.CfnResolver","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AppSync::Resolver","aws:cdk:cloudformation:props":{"apiId":{"Fn::GetAtt":["EduMatchMessagingApiBA77C261","ApiId"]},"dataSourceName":"ThreadsDataSource","fieldName":"getUnreadCount","kind":"UNIT","requestMappingTemplate":"\n\t\t\t\t#set($userId = $ctx.identity.sub)\n\t\t\t\t#if($ctx.args.userId)\n\t\t\t\t\t#set($userId = $ctx.args.userId)\n\t\t\t\t#end\n\t\t\t\t#if($userId)\n\t\t\t\t{\n\t\t\t\t\t\"version\": \"2017-02-28\",\n\t\t\t\t\t\"operation\": \"Query\",\n\t\t\t\t\t\"query\": {\n\t\t\t\t\t\t\"expression\": \"userId = :userId\",\n\t\t\t\t\t\t\"expressionValues\": {\n\t\t\t\t\t\t\t\":userId\": $util.dynamodb.toDynamoDBJson($userId)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t#else\n\t\t\t\t$util.error(\"User ID is required\", \"BadRequest\")\n\t\t\t\t#end\n\t\t\t","responseMappingTemplate":"\n\t\t\t\t#set($totalUnread = 0)\n\t\t\t\t#foreach($item in $ctx.result.items)\n\t\t\t\t\t#set($totalUnread = $totalUnread + $item.unreadCount)\n\t\t\t\t#end\n\t\t\t\t$totalUnread\n\t\t\t","typeName":"Query"}}}}}}},"WishlistDeadlineCronLogGroup":{"id":"WishlistDeadlineCronLogGroup","path":"EduMatchNotificationStack/WishlistDeadlineCronLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/WishlistDeadlineCronLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"retentionInDays":7}}}}},"WishlistDeadlineCron":{"id":"WishlistDeadlineCron","path":"EduMatchNotificationStack/WishlistDeadlineCron","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/WishlistDeadlineCron/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nconst https = require('https');\nconst http = require('http');\n\nexports.handler = async (event) => {\n  console.log('ðŸ”„ Starting wishlist deadline cron job...');\n  console.log('ðŸ“¦ Event received:', JSON.stringify(event, null, 2));\n  \n  const apiUrl = process.env.API_BASE_URL || 'https://dev.d1jaxpbx3axxsh.amplifyapp.com';\n  const cronSecret = process.env.CRON_SECRET;\n  \n  console.log('ðŸ“ API URL:', apiUrl);\n  console.log('ðŸ”‘ CRON_SECRET set:', !!cronSecret);\n  \n  if (!cronSecret) {\n    console.warn('âš ï¸ WARNING: CRON_SECRET not set in Lambda environment variables!');\n    console.warn('âš ï¸ The API endpoint may reject the request if CRON_SECRET is required.');\n  }\n  \n  try {\n    const url = new URL(apiUrl + '/api/cron/wishlist-deadlines');\n    const headers = {\n      'Content-Type': 'application/json',\n    };\n    \n    // Only add Authorization header if CRON_SECRET is set\n    if (cronSecret) {\n      headers['Authorization'] = `Bearer ${cronSecret}`;\n    }\n    \n    const options = {\n      method: 'POST',\n      headers: headers,\n      timeout: 30000, // 30 seconds\n    };\n    \n    const response = await new Promise((resolve, reject) => {\n      const client = url.protocol === 'https:' ? https : http;\n      \n      const req = client.request(url, options, (res) => {\n        let data = '';\n        \n        res.on('data', (chunk) => {\n          data += chunk;\n        });\n        \n        res.on('end', () => {\n          resolve({\n            statusCode: res.statusCode,\n            headers: res.headers,\n            body: data,\n          });\n        });\n      });\n      \n      req.on('error', (error) => {\n        reject(error);\n      });\n      \n      req.on('timeout', () => {\n        req.destroy();\n        reject(new Error('Request timeout'));\n      });\n      \n      req.end();\n    });\n    \n    console.log('ðŸ“Š Response status:', response.statusCode);\n    console.log('ðŸ“Š Response headers:', JSON.stringify(response.headers, null, 2));\n    console.log('ðŸ“Š Response body length:', response.body ? response.body.length : 0);\n    console.log('ðŸ“Š Response body preview (first 200 chars):', response.body ? response.body.substring(0, 200) : 'empty');\n    \n    // Check if response is HTML (404 or error page) - check before parsing\n    const bodyStr = response.body || '';\n    const trimmedBody = bodyStr.trim();\n    \n    if (trimmedBody && (trimmedBody.startsWith('<!DOCTYPE') || trimmedBody.startsWith('<html') || trimmedBody.startsWith('<!doctype'))) {\n      console.error('âŒ API returned HTML instead of JSON - likely 404 or error page');\n      console.error('âŒ Response status:', response.statusCode);\n      console.error('âŒ Response body (first 500 chars):', trimmedBody.substring(0, 500));\n      throw new Error(`API endpoint returned HTML (likely 404). Status: ${response.statusCode}. The route /api/cron/wishlist-deadlines does not exist or is not deployed. Please deploy your Next.js app to include this route.`);\n    }\n    \n    // Check if status code indicates error\n    if (response.statusCode >= 400) {\n      console.error('âŒ API returned error status:', response.statusCode);\n      console.error('âŒ Response body (first 500 chars):', trimmedBody.substring(0, 500));\n      throw new Error(`API endpoint returned error status ${response.statusCode}. Response: ${trimmedBody.substring(0, 200)}`);\n    }\n    \n    let result;\n    try {\n      result = JSON.parse(bodyStr);\n    } catch (parseError) {\n      console.error('âŒ Failed to parse response body as JSON');\n      console.error('âŒ Response status:', response.statusCode);\n      console.error('âŒ Response body (first 500 chars):', trimmedBody.substring(0, 500));\n      throw new Error(`Failed to parse API response as JSON: ${parseError.message}. Response might be HTML or invalid JSON. Status: ${response.statusCode}`);\n    }\n    \n    if (response.statusCode === 200) {\n      console.log('âœ… Cron job executed successfully:', JSON.stringify(result, null, 2));\n      return {\n        statusCode: 200,\n        body: JSON.stringify({\n          success: true,\n          message: 'Wishlist deadline cron job completed',\n          result,\n        }),\n      };\n    } else {\n      console.error('âŒ API returned error:', response.statusCode, result);\n      throw new Error(`API returned ${response.statusCode}: ${JSON.stringify(result)}`);\n    }\n  } catch (error) {\n    console.error('âŒ Error executing cron job:', error);\n    console.error('âŒ Error stack:', error.stack);\n    throw error;\n  }\n};\n      "},"environment":{"variables":{"API_BASE_URL":"https://dev.d1jaxpbx3axxsh.amplifyapp.com","CRON_SECRET":""}},"handler":"index.handler","loggingConfig":{"logGroup":{"Ref":"WishlistDeadlineCronLogGroupE76C266E"}},"memorySize":256,"role":{"Fn::GetAtt":["NotificationLambdaRole8517A721","Arn"]},"runtime":"nodejs18.x","timeout":300}}}}},"WishlistDeadlineRule":{"id":"WishlistDeadlineRule","path":"EduMatchNotificationStack/WishlistDeadlineRule","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"EduMatchNotificationStack/WishlistDeadlineRule/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"description":"Trigger wishlist deadline notifications daily at 9 AM UTC","scheduleExpression":"cron(0 9 * * ? *)","state":"ENABLED","targets":[{"id":"Target0","arn":{"Fn::GetAtt":["WishlistDeadlineCron419D9359","Arn"]}}]}}},"AllowEventRuleEduMatchNotificationStackWishlistDeadlineCron0FAC1353":{"id":"AllowEventRuleEduMatchNotificationStackWishlistDeadlineCron0FAC1353","path":"EduMatchNotificationStack/WishlistDeadlineRule/AllowEventRuleEduMatchNotificationStackWishlistDeadlineCron0FAC1353","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["WishlistDeadlineCron419D9359","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["WishlistDeadlineRuleFF2DFDA3","Arn"]}}}}}},"NotificationsQueueUrl":{"id":"NotificationsQueueUrl","path":"EduMatchNotificationStack/NotificationsQueueUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"EmailsQueueUrl":{"id":"EmailsQueueUrl","path":"EduMatchNotificationStack/EmailsQueueUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"NotificationProcessorArn":{"id":"NotificationProcessorArn","path":"EduMatchNotificationStack/NotificationProcessorArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"EmailProcessorArn":{"id":"EmailProcessorArn","path":"EduMatchNotificationStack/EmailProcessorArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"AppSyncApiEndpoint":{"id":"AppSyncApiEndpoint","path":"EduMatchNotificationStack/AppSyncApiEndpoint","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"AppSyncApiKey":{"id":"AppSyncApiKey","path":"EduMatchNotificationStack/AppSyncApiKey","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"MessagesTableName":{"id":"MessagesTableName","path":"EduMatchNotificationStack/MessagesTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"ThreadsTableName":{"id":"ThreadsTableName","path":"EduMatchNotificationStack/ThreadsTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"WishlistDeadlineCronArn":{"id":"WishlistDeadlineCronArn","path":"EduMatchNotificationStack/WishlistDeadlineCronArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"WishlistDeadlineRuleArn":{"id":"WishlistDeadlineRuleArn","path":"EduMatchNotificationStack/WishlistDeadlineRuleArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"EduMatchNotificationStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"EduMatchNotificationStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"EduMatchNotificationStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.219.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"EduMatchNotificationStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.219.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}