
generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================
// Existing models (unchanged)
// ==================
model User {
  id               String    @id
  name             String
  email            String    @unique
  emailVerified    Boolean   @default(false)
  image            String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @default(now()) @updatedAt
  stripeCustomerId String?
  accounts         Account[]
  sessions         Session[]
  profile          Profile?

  role       String?
  banned     Boolean?  @default(false)
  banReason  String?
  banExpires DateTime?

  // Additional relations
  emails              Email[]
  notifications       Notification[]
  wishlists          Wishlist[]
  applications       Application[]
  createdThreads     Thread[] @relation("ThreadCreatedBy")
  participantThreads Thread[] @relation("ThreadParticipant")
  sentMessages       Mesage[]

  @@map("User")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}

model Subscription {
  id                   String    @id
  plan                 String
  referenceId          String
  stripeCustomerId     String?
  stripeSubscriptionId String?
  status               String?
  periodStart          DateTime?
  periodEnd            DateTime?
  cancelAtPeriodEnd    Boolean?  @default(false)
  seats                Int?
  trialStart           DateTime?
  trialEnd             DateTime?

  @@map("subscription")
}

model Message {
  id        String   @id
  text      String
  userName  String
  roomId    String   @default("general")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("Message")
}

model Post {
  id        String   @id
  title     String
  content   String?
  published Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  authorId  String

  @@map("Post")
}

model File {
  id           String        @id @default(uuid())
  name         String
  originalName String        @map("originalName")
  key          String        @unique
  bucket       String
  size         Int?
  mimeType     String?       @map("mimeType")
  extension    String?
  category     String        @default("other")
  url          String?
  isPublic     Boolean       @default(false) @map("isPublic")
  metadata     Json?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  userId       String
  folderId     String?
  profileFiles ProfileFile[]

  @@map("file")
}

model Folder {
  id          String   @id
  name        String
  description String?
  path        String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId      String
  parentId    String?

  @@map("folder")
}

model Profile {
  id                 String          @id @default(uuid())
  userId             String          @unique
  role               String
  firstName          String
  lastName           String
  gender             String
  birthday           String
  nationality        String
  phoneNumber        String
  countryCode        String
  interests          String[]        @default([])
  favoriteCountries  String[]        @default([])
  profilePhoto       String?
  graduationStatus   String?
  degree             String?
  fieldOfStudy       String?
  university         String?
  graduationYear     String?
  gpa                String?
  countryOfStudy     String?
  scoreType          String?
  scoreValue         String?
  hasForeignLanguage String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  languages          Language[]
  user               User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  uploadedFiles      ProfileFile[]
  researchPapers     ResearchPaper[]

  @@map("profile")
}

model Language {
  id          String   @id @default(uuid())
  profileId   String
  language    String
  certificate String
  score       String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("language")
}

model ResearchPaper {
  id         String        @id @default(uuid())
  profileId  String
  title      String
  discipline String
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  files      ProfileFile[]
  profile    Profile       @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("research_paper")
}

model ProfileFile {
  id              String         @id @default(uuid())
  profileId       String?
  researchPaperId String?
  fileId          String
  category        String
  createdAt       DateTime       @default(now())
  file            File           @relation(fields: [fileId], references: [id], onDelete: Cascade)
  profile         Profile?       @relation(fields: [profileId], references: [id], onDelete: Cascade)
  researchPaper   ResearchPaper? @relation(fields: [researchPaperId], references: [id], onDelete: Cascade)

  @@map("profile_file")
}

// ==================
// New models mapped to your extra PostgreSQL tables
// (Only NON-CONFLICTING table names are added.)
// ==================

model Email {
  id        String   @id @default(uuid())
  userId    String
  from      String   @map("from")
  to        String
  subject   String
  status    String
  createAt  DateTime @map("createAt")
  queuedAt  DateTime @map("queuedAt")
  readAt    DateTime? @map("read_at")

  user      User     @relation(fields: [userId], references: [id], onDelete: NoAction)

  @@map("Email")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  type      String   // message | application | system
  title     String
  bodyText  String
  url       String
  payload   Json
  createAt  DateTime @map("createAt")
  queuedAt  DateTime @map("queuedAt")
  readAt    DateTime? @map("read_at")
  status    String

  user      User     @relation(fields: [userId], references: [id], onDelete: NoAction)

  @@map("Notification")
}

model Plan {
  id        String   @id
  code      String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime

  subscriptions Subcription[]

  @@map("plan")
}

model Subcription { // CHANGED: kept original misspelling to match table name
  planId              String
  referenceId         String
  stripeCustomerId    String
  stripeSubcriptionId String   @id // CHANGED: primary key per DDL
  status              String
  periodStart         DateTime?
  periodEnd           DateTime?
  cancelAtPeriodEnd   Boolean? @default(false)
  trialStart          DateTime?
  trialEnd            DateTime?
  createdAt           DateTime @default(now())
  updatedAt           DateTime

  // CHANGED: add relation to Plan
  plan                Plan     @relation(fields: [planId], references: [id], onDelete: NoAction)

  @@map("Subcription")
}

model Wishlist {
  postId    String
  userId    String
  createdAt DateTime @default(now())
  status    Int

  // CHANGED: add relation to User (post kept scalar due to name/table conflict)
  user      User     @relation(fields: [userId], references: [id], onDelete: NoAction)

  @@id([postId, userId])
  @@map("Wishlist")
}

model Discipline {
  id        Int      @id @default(autoincrement())
  name      String
  status    Boolean
  createdAt DateTime @default(now())

  subDisciplines Sub_Discipline[]

  @@map("discipline")
}

model Sub_Discipline {
  id           Int      @id @default(autoincrement())
  disciplineId Int
  name         String
  status       Boolean  @default(true)
  created_at   DateTime @default(now())

  // Relations
  discipline   Discipline @relation(fields: [disciplineId], references: [id], onDelete: NoAction)
  institutions InstitutionProfile[]

  @@map("Sub_Discipline")
}

model InstitutionProfile {
  profile_id      String  @id
  logo            String
  name            String
  abbreviation    String
  hotline         String  @db.VarChar(12)
  type            String
  website         String
  country         String
  address         String
  rep_name        String
  rep_appellation DateTime @db.Date
  rep_position    String
  rep_email       String
  rep_phone       String
  about           String
  subdiscipline   Int
  cover_image     String

  // Relations
  subDiscipline   Sub_Discipline @relation(fields: [subdiscipline], references: [id], onDelete: NoAction)
  campuses        Campus[]

  @@map("institution_profile")
}

model Campus {
  id        Int      @id @default(autoincrement())
  country   String
  address   String
  status    Boolean
  createAt  DateTime
  updateAt  DateTime @db.Timestamp
  profileId String

  // CHANGED: add relation to InstitutionProfile
  institution InstitutionProfile @relation(fields: [profileId], references: [profile_id], onDelete: NoAction)

  @@map("campus")
}

model Document {
  id          String  @id @default(uuid())
  bucket      String
  objectKey   String
  size        Int
  contentType String
  metadata    Json

  profileAttachments     ProfileAttachment[]
  applicationAttachments ApplicationAttachment[]

  @@map("Document")
}

model ProfileAttachment {
  documentId String @id
  profile_id String 
  status     Boolean
  createdAt  DateTime @default(now())
  name       String?
  description String? @map("d√©cription")

  // Relations
  document   Document @relation(fields: [documentId], references: [id], onDelete: NoAction)

  @@map("profile_attachment")
}

model Application {
  id          String   @id @default(uuid())
  postId      String
  applicantId String
  submittedAt DateTime
  status      String
  updateAt    DateTime?

  // Relations
  applicant   User     @relation(fields: [applicantId], references: [id], onDelete: NoAction)
  attachments ApplicationAttachment[]

  @@map("application")
}

model ApplicationAttachment {
  documentId    String @id
  applicationId String 
  name          String
  description   String
  status        Boolean
  createdAt     DateTime @default(now())

  // Relations
  document      Document    @relation(fields: [documentId], references: [id], onDelete: NoAction)
  application   Application @relation(fields: [applicationId], references: [id], onDelete: NoAction)

  @@map("application_attachment")
}

model Certificate {
  id         Int     @id @default(autoincrement())
  profile_id String
  language   String
  score      String
  status     Int
  createdAt  DateTime @default(now())

  // CHANGED: add relation to StudentProfile
  student    StudentProfile @relation(fields: [profile_id], references: [profile_id], onDelete: NoAction)

  @@map("certificate")
}

model Role {
  id     Int    @id @default(autoincrement())
  name   String
  status Boolean

  @@map("role")
}

model StudentProfile {
  profile_id     String  @id
  firstName      String
  LastName       String
  birthDay       DateTime @db.Date
  gender         Boolean
  phone          String   @db.VarChar(12)
  graduated      Boolean
  university     String?
  degreeLevel    String
  institution    String
  gpa            Decimal
  subDisciplineId BigInt
  fav_country    String?

  certificates   Certificate[]

  @@map("student_profile")
}

model Favorite_Subdiscipline {
  profileId       String
  subdisciplineId Int     @default(autoincrement())
  created_at      DateTime @default(now())
  updateAt        DateTime?

  @@id([profileId, subdisciplineId])
  @@map("Favorite_Subdiscipline")
}

model Thread {
  id            String   @id @default(uuid())
  createdBy     String   
  participantId String   
  lastMessageId String
  lastMessageAt DateTime
  createdAt     DateTime

  // Relations
  createdByUser User @relation("ThreadCreatedBy", fields: [createdBy], references: [id], onDelete: NoAction)
  participant   User @relation("ThreadParticipant", fields: [participantId], references: [id], onDelete: NoAction)
  messages      Mesage[]

  @@map("thread")
}

model Mesage { // CHANGED: preserves table name typo "mesage"
  id        String   @id @default(uuid())
  senderId  String   
  threadId  String   
  body      String
  createdAt DateTime

  // Relations
  sender    User    @relation(fields: [senderId], references: [id], onDelete: NoAction)
  thread    Thread  @relation(fields: [threadId], references: [id], onDelete: NoAction)

  @@map("mesage")
}

model PostProgram {
  PostId        String  @id
  duration      String
  degreeLevel   String
  CourseInclude String?
  professor_name String?
  gpa           Decimal?
  gre           Int?
  gmat          Int?
  tuition_fee   Decimal?
  fee_description String?
  scholarship_info String?

  @@map("Post_program")
}

model PostScholarship {
  PostId              String @id
  detail              String
  type                String
  number              Int?
  grant               String?
  scholarship_coverage String?
  essay_required      Boolean?
  eligibility         String?

  @@map("Post_scholarship")
}

model PostJob {
  PostId                String @id
  contract_type         String
  job_type              String
  min_salary            Decimal
  max_salary            Decimal
  salary_description    String?
  benefit               String?
  main_responsibility   String?
  qualification_requirement String?
  experience_requirement String?
  assessment_criteria   String?
  other_requirement     String?

  @@map("Post_job")
}

model PostFileRequirement {
  id          String  @id @default(uuid())
  postId      String
  name        String
  description String?

  @@map("post_file_requirement")
}

// ==================
// Notes
// - Conflicting tables ("User", "Account", "Session", "Verification", "Post", "Profile")
//   are ALREADY mapped by your existing models above. The additional raw SQL definitions
//   of those tables differ in shape, so we DID NOT remap them to avoid breaking changes.
// - Relations between the newly added models and existing ones are intentionally left as
//   scalar foreign keys to keep changes minimal. You can incrementally add @relation()s later.
// - Run: npx prisma generate && npx prisma db push  // CHANGED: db push to sync models
